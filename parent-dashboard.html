<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Parent Dashboard - Assured Hearts</title>
    <meta name="description" content="Manage your childcare, bookings, and children's learning." />
    <link rel="stylesheet" href="style.css">
  </head>

  <body>
    <nav class="navbar">
      <div class="nav-container">
        <div class="logo"><a href="index.html" style="display: flex; align-items: center; gap: 8px; text-decoration: none; color: inherit;"><img src="Assets/assured Hearts Logo.png" alt="Assured Hearts Logo"><span>Assured Hearts</span></a></div>
        <div class="nav-links">
          <a href="find-childcare.html">Find Childcare</a>
          <a href="become-provider.html">Join Our Care Network</a>
          <a href="care-process.html">Our Care Process</a>
          <a href="learning.html">At-Home Learning</a>
        </div>
        <div class="nav-auth">
          <a href="parent-dashboard.html" style="display: flex; align-items: center; gap: 6px; color: #06464E; text-decoration: none; font-weight: 600;">Dashboard</a>
          <button id="logoutBtn" class="btn-auth" style="background: #f5f5f5; color: #333;">Log out</button>
        </div>
        <button id="mobileMenuBtn" class="mobile-menu" aria-label="Open menu">
          <span></span>
          <span></span>
        </button>
      </div>
    </nav>

    <div id="mobileMenu" class="mobile-menu-panel hidden" aria-hidden="true">
      <button id="mobileMenuClose" class="mobile-menu-close" aria-label="Close menu">&times;</button>
      <nav class="mobile-nav">
        <a href="find-childcare.html">Find Childcare</a>
        <a href="become-provider.html">Join Our Care Network</a>
        <a href="care-process.html">Our Care Process</a>
        <a href="learning.html">At-Home Learning</a>
        <a href="parent-dashboard.html">Dashboard</a>
      </nav>
    </div>

    <header class="hero" style="padding: 48px 16px; background: linear-gradient(135deg, #f4fbfd 0%, #fff7f7 100%);">
      <div class="container" style="max-width: 1200px;">
        <h1 id="dashboardGreeting" style="margin-bottom: 8px;">Welcome back!</h1>
        <p class="lead" style="margin-bottom: 0;">Manage your family's care and learning journey</p>
      </div>
    </header>

    <main class="container" style="padding: 48px 24px; max-width: 1200px;">
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 32px;">
        <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); border-left: 4px solid #67B3C2;">
          <h3 style="margin: 0 0 8px 0; color: #06464E; font-size: 16px;">Children on File</h3>
          <p id="statChildren" style="margin: 0; font-size: 32px; font-weight: 700; color: #67B3C2;">0</p>
        </div>
        <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); border-left: 4px solid #06464E;">
          <h3 style="margin: 0 0 8px 0; color: #06464E; font-size: 16px;">Active Bookings</h3>
          <p style="margin: 0; font-size: 32px; font-weight: 700; color: #06464E;">0</p>
        </div>
        <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); border-left: 4px solid #67B3C2;">
          <h3 style="margin: 0 0 8px 0; color: #06464E; font-size: 16px;">Messages</h3>
          <p style="margin: 0; font-size: 32px; font-weight: 700; color: #67B3C2;">0</p>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 32px;">
        
        <section style="background: white; padding: 28px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0; color: #06464E;">Your Children</h2>
            <a href="child-demographics.html" class="btn" style="padding: 8px 16px; font-size: 14px; background: linear-gradient(135deg, #67B3C2 0%, #06464E 100%); color: white; text-decoration: none; border-radius: 8px;">Add Child</a>
          </div>
          
          <div id="childrenList" style="display: flex; flex-direction: column; gap: 12px; min-height: 100px;">
            <p style="color: #999; text-align: center; padding: 20px; margin: 0;">Loading your children...</p>
          </div>
        </section>

        <section style="background: white; padding: 28px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
          <h2 style="margin: 0 0 16px 0; color: #06464E;">Quick Actions</h2>
          <div style="display: grid; gap: 10px;">
            <a href="find-childcare.html" style="display: block; padding: 14px 16px; background: #f8fbfc; border: 1px solid #e5e7eb; border-radius: 8px; text-decoration: none; color: #06464E; font-weight: 600; transition: background 0.2s;">
              üîç Find Caregivers
            </a>
            <a id="requestChildcareAction" href="request-childcare.html" style="display: block; padding: 14px 16px; background: #eef7f2; border: 1px solid #cfe9d7; border-radius: 8px; text-decoration: none; color: #2d6b42; font-weight: 600; transition: background 0.2s;">
              ‚úÖ Request Childcare
            </a>
            <a href="#" style="display: block; padding: 14px 16px; background: #f8fbfc; border: 1px solid #e5e7eb; border-radius: 8px; text-decoration: none; color: #06464E; font-weight: 600; transition: background 0.2s;">
              üí¨ Messages
            </a>
            <a href="learning.html" style="display: block; padding: 14px 16px; background: #f8fbfc; border: 1px solid #e5e7eb; border-radius: 8px; text-decoration: none; color: #06464E; font-weight: 600; transition: background 0.2s;">
              üìö Learning Activities
            </a>
            <a href="#" style="display: block; padding: 14px 16px; background: #f8fbfc; border: 1px solid #e5e7eb; border-radius: 8px; text-decoration: none; color: #06464E; font-weight: 600; transition: background 0.2s;">
              ‚öôÔ∏è Account Settings
            </a>
          </div>
        </section>

      </div>

      <section style="background: white; padding: 28px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
        <h2 style="margin: 0 0 16px 0; color: #06464E;">Children's Learning Progress</h2>
        
        <div id="learningProgress" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px;">
          <p style="color: #999; text-align: center; padding: 20px; margin: 0;">Loading children's progress...</p>
        </div>
      </section>

    </main>

    <footer style="background: #06464E; color: white; padding: 32px 24px; text-align: center; margin-top: 48px;">
      <p style="margin: 0;">¬© 2025 Assured Hearts. All rights reserved.</p>
    </footer>

    <script src="script.js"></script>
    <script>
      const API_BASE = 'https://assured-hearts-api.onrender.com/api' || 'http://localhost:3000/api';

      async function loadParentDashboard() {
        const userId = localStorage.getItem('user_id');
        const userName = localStorage.getItem('user_name');

        // Update greeting
        if(userName) {
          document.getElementById('dashboardGreeting').textContent = `Welcome back, ${userName}!`;
        }

        if(!userId) {
          window.location.href = 'index.html';
          return;
        }

        try {
          const res = await fetch(`${API_BASE}/forms/parent/${userId}`);
          if(!res.ok) {
            console.error('Failed to load dashboard:', res.status);
            return;
          }

          const data = await res.json();
          const { profile, children } = data;

          // Update stats
          document.getElementById('statChildren').textContent = children.length;

          // Render children list
          const childrenList = document.getElementById('childrenList');
          if(children.length === 0) {
            childrenList.innerHTML = '<p style="color: #999; text-align: center; padding: 20px; margin: 0;">No children added yet. <a href="child-demographics.html" style="color: #67B3C2; font-weight: 600;">Add a child</a></p>';
          } else {
            childrenList.innerHTML = children.map(child => {
              const ages = child.ages ? JSON.parse(child.ages) : [];
              const ageStr = Array.isArray(ages) ? ages.join(', ') : ages;
              const initial = profile.name.charAt(0).toUpperCase();
              return `
                <div style="border: 1px solid #e5e7eb; border-radius: 10px; padding: 16px; display: flex; justify-content: space-between; align-items: start;">
                  <div style="display: flex; gap: 12px; flex: 1;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #67B3C2 0%, #06464E 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; flex-shrink: 0;">${initial}</div>
                    <div style="flex: 1;">
                      <h3 style="margin: 0 0 4px 0; color: #06464E; font-size: 16px;">Child Profile</h3>
                      <p style="margin: 0; color: #666; font-size: 14px;">Age: ${ageStr || 'Not specified'}</p>
                      ${child.frequency ? `<p style="margin: 4px 0 0 0; color: #666; font-size: 14px;">Frequency: ${child.frequency}</p>` : ''}
                    </div>
                  </div>
                  <a href="child-demographics.html" style="color: #67B3C2; font-weight: 600; text-decoration: none; font-size: 14px; white-space: nowrap; margin-left: 12px;">Edit</a>
                </div>
              `;
            }).join('');
          }

          // Render learning progress section (placeholder for now)
          const learningProgress = document.getElementById('learningProgress');
          if(children.length === 0) {
            learningProgress.innerHTML = '<p style="color: #999; text-align: center; padding: 20px; margin: 0;">Add children to track learning progress</p>';
          } else {
            learningProgress.innerHTML = children.map(child => {
              const initial = profile.name.charAt(0).toUpperCase();
              return `
                <div style="border: 1px solid #e5e7eb; border-radius: 10px; padding: 18px;">
                  <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                    <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #67B3C2 0%, #06464E 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; font-weight: 700;">${initial}</div>
                    <div>
                      <h3 style="margin: 0; color: #06464E;">Child Profile</h3>
                      <p style="margin: 0; color: #666; font-size: 14px;">Learning in progress</p>
                    </div>
                  </div>
                  <p style="margin: 0 0 8px 0; color: #666; font-size: 14px;">Track your child's learning journey</p>
                  <a href="learning.html" style="color: #06464E; font-weight: 600; text-decoration: none; font-size: 14px;">View progress ‚Üí</a>
                </div>
              `;
            }).join('');
          }

        } catch(err) {
          console.error('Dashboard error:', err);
          showBanner('Error loading dashboard', 'error');
        }
      }

      // Load dashboard on page load
      window.addEventListener('DOMContentLoaded', loadParentDashboard);

      // Handle logout
      document.getElementById('logoutBtn')?.addEventListener('click', () => {
        localStorage.clear();
        window.location.href = 'index.html';
      });
    </script>
  </body>
</html>
