<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Parent Dashboard - Assured Hearts</title>
    <meta name="description" content="Manage your childcare, bookings, and children's learning." />
    <link rel="stylesheet" href="style.css">
  </head>

  <body>
    <nav class="navbar">
      <div class="nav-container">
        <div class="logo"><a href="index.html" style="display: flex; align-items: center; gap: 8px; text-decoration: none; color: inherit;"><img src="Assets/assured Hearts Logo.png" alt="Assured Hearts Logo"><span>Assured Hearts</span></a></div>
        <div class="nav-links">
          <a href="find-childcare.html">Find Childcare</a>
          <a href="become-provider.html">Join Our Care Network</a>
          <a href="care-process.html">Our Care Process</a>
          <a href="learning.html">At-Home Learning</a>
        </div>
        <div class="nav-auth">
          <a href="parent-dashboard.html" style="display: flex; align-items: center; gap: 6px; color: #06464E; text-decoration: none; font-weight: 600;">Dashboard</a>
          <button id="logoutBtn" class="btn-auth" style="background: #f5f5f5; color: #333;">Log out</button>
        </div>
        <button id="mobileMenuBtn" class="mobile-menu" aria-label="Open menu">
          <span></span>
          <span></span>
        </button>
      </div>
    </nav>

    <div id="mobileMenu" class="mobile-menu-panel hidden" aria-hidden="true">
      <button id="mobileMenuClose" class="mobile-menu-close" aria-label="Close menu">&times;</button>
      <nav class="mobile-nav">
        <a href="find-childcare.html">Find Childcare</a>
        <a href="become-provider.html">Join Our Care Network</a>
        <a href="care-process.html">Our Care Process</a>
        <a href="learning.html">At-Home Learning</a>
        <a href="parent-dashboard.html">Dashboard</a>
      </nav>
    </div>

    <header class="hero" style="padding: 24px 16px; background: linear-gradient(135deg, #f4fbfd 0%, #fff7f7 100%);">
      <div class="container" style="max-width: 1200px;">
        <h1 id="dashboardGreeting" style="margin: 0; font-size: clamp(24px, 5vw, 28px);">Welcome back!</h1>
      </div>
    </header>

    <main class="container" style="padding: 24px 16px; max-width: 1200px; margin: 0 auto;">
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 24px;">
        <div style="background: white; padding: 14px; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border-left: 3px solid #67B3C2;">
          <h3 style="margin: 0 0 6px 0; color: #06464E; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Requests</h3>
          <p id="statRequests" style="margin: 0; font-size: clamp(20px, 6vw, 24px); font-weight: 700; color: #67B3C2;">0</p>
        </div>
        <div style="background: white; padding: 14px; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border-left: 3px solid #06464E;">
          <h3 style="margin: 0 0 6px 0; color: #06464E; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Upcoming</h3>
          <p id="statUpcoming" style="margin: 0; font-size: clamp(20px, 6vw, 24px); font-weight: 700; color: #06464E;">0</p>
        </div>
        <div style="background: white; padding: 14px; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border-left: 3px solid #67B3C2;">
          <h3 style="margin: 0 0 6px 0; color: #06464E; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Messages</h3>
          <p id="statMessages" style="margin: 0; font-size: clamp(20px, 6vw, 24px); font-weight: 700; color: #67B3C2;">0</p>
        </div>
      </div>

      <section style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); margin-bottom: 16px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 12px;">
          <h2 style="margin: 0; color: #06464E; font-size: 16px; font-weight: 600;">Your Requests</h2>
          <a href="request-childcare.html" class="btn" style="padding: 8px 14px; font-size: 12px; background: linear-gradient(135deg, #67B3C2 0%, #06464E 100%); color: white; text-decoration: none; border-radius: 6px; white-space: nowrap;">New Request</a>
        </div>
        
        <div id="requestsList" style="display: flex; flex-direction: column; gap: 10px; min-height: 60px;">
          <p style="color: #999; text-align: center; padding: 20px; margin: 0;">Loading your requests...</p>
        </div>
      </section>

      <section style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); margin-bottom: 16px;">
        <h2 style="margin: 0 0 16px 0; color: #06464E; font-size: 16px; font-weight: 600;">Upcoming Care</h2>
        
        <div id="upcomingList" style="display: flex; flex-direction: column; gap: 10px; min-height: 60px;">
          <p style="color: #999; text-align: center; padding: 20px; margin: 0;">No upcoming sessions scheduled</p>
        </div>
      </section>

      <div style="display: grid; grid-template-columns: 1fr; gap: 16px; margin-bottom: 24px;">
        
        <section style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 12px;">
            <h2 style="margin: 0; color: #06464E; font-size: 16px; font-weight: 600;">Your Children</h2>
            <a href="child-demographics.html" class="btn" style="padding: 8px 14px; font-size: 12px; background: linear-gradient(135deg, #67B3C2 0%, #06464E 100%); color: white; text-decoration: none; border-radius: 6px; white-space: nowrap;">Add Child</a>
          </div>
          
          <div id="childrenList" style="display: flex; flex-direction: column; gap: 10px; min-height: 60px;">
            <p style="color: #999; text-align: center; padding: 20px; margin: 0;">Loading your children...</p>
          </div>
        </section>

      </div>

      <section style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
        <h2 style="margin: 0 0 12px 0; color: #06464E; font-size: 16px; font-weight: 600;">Learning Progress</h2>
        
        <div id="learningProgress" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
          <p style="color: #999; text-align: center; padding: 20px; margin: 0;">Loading children's progress...</p>
        </div>
      </section>

    </main>

    <footer style="background: #06464E; color: white; padding: 16px 24px; text-align: center; margin-top: 32px; font-size: 12px;">
      <p style="margin: 0;">© 2025 Assured Hearts. All rights reserved.</p>
    </footer>

    <script src="script.js"></script>
    <script>
      const API_BASE = 'https://assured-hearts-api.onrender.com/api' || 'http://localhost:3000/api';

      async function loadParentDashboard() {
        const userId = localStorage.getItem('user_id');
        const userName = localStorage.getItem('user_name');

        // Update greeting
        if(userName) {
          document.getElementById('dashboardGreeting').textContent = `Welcome back, ${userName}!`;
        }

        if(!userId) {
          window.location.href = 'index.html';
          return;
        }

        try {
          const res = await fetch(`${API_BASE}/forms/parent/${userId}`);
          if(!res.ok) {
            console.error('Failed to load dashboard:', res.status);
            return;
          }

          const data = await res.json();
          const { profile, children } = data;

          // Render requests list (placeholder for now)
          const requestsList = document.getElementById('requestsList');
          requestsList.innerHTML = '<p style="color: #999; text-align: center; padding: 20px; margin: 0;">No childcare requests yet. <a href="request-childcare.html" style="color: #67B3C2; font-weight: 600;">Submit a request</a></p>';

          // Render children list
          const childrenList = document.getElementById('childrenList');
          if(children.length === 0) {
            childrenList.innerHTML = '<p style="color: #999; text-align: center; padding: 20px; margin: 0;">No children added yet. <a href="child-demographics.html" style="color: #67B3C2; font-weight: 600;">Add a child</a></p>';
          } else {
            childrenList.innerHTML = children.map(child => {
              const ages = child.ages ? JSON.parse(child.ages) : [];
              const ageStr = Array.isArray(ages) ? ages.join(', ') : ages;
              const initial = profile.name.charAt(0).toUpperCase();
              return `
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 14px; display: flex; justify-content: space-between; align-items: center; font-size: 13px; gap: 12px;">
                  <div style="display: flex; gap: 10px; align-items: center; flex: 1; min-width: 0;">
                    <div style="width: 36px; height: 36px; background: linear-gradient(135deg, #67B3C2 0%, #06464E 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; flex-shrink: 0; font-size: 14px;">${initial}</div>
                    <div style="flex: 1; min-width: 0;">
                      <p style="margin: 0; color: #06464E; font-weight: 500; word-break: break-word;">Age ${ageStr || 'TBD'}</p>
                      ${child.frequency ? `<p style="margin: 2px 0 0 0; color: #999; font-size: 12px; word-break: break-word;">${child.frequency}</p>` : ''}
                    </div>
                  </div>
                  <a href="child-demographics.html" style="color: #67B3C2; font-weight: 600; text-decoration: none; font-size: 12px; white-space: nowrap; padding: 8px; margin-left: auto;">Edit</a>
                </div>
              `;
            }).join('');
          }

          // Render learning progress section (placeholder for now)
          const learningProgress = document.getElementById('learningProgress');
          if(children.length === 0) {
            learningProgress.innerHTML = '<p style="color: #999; text-align: center; padding: 20px; margin: 0;">Add children to track learning progress</p>';
          } else {
            learningProgress.innerHTML = children.map(child => {
              const initial = profile.name.charAt(0).toUpperCase();
              return `
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 14px; text-align: center;">
                  <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #67B3C2 0%, #06464E 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; font-weight: 700; margin: 0 auto 8px;">${initial}</div>
                  <p style="margin: 0 0 4px 0; color: #06464E; font-weight: 500; font-size: 13px;">Child Profile</p>
                  <p style="margin: 0 0 8px 0; color: #999; font-size: 12px;">Track progress</p>
                  <a href="learning.html" style="color: #06464E; font-weight: 600; text-decoration: none; font-size: 12px; padding: 8px; display: inline-block;">View →</a>
                </div>
              `;
            }).join('');
          }

        } catch(err) {
          console.error('Dashboard error:', err);
          showBanner('Error loading dashboard', 'error');
        }
      }

      // Load dashboard on page load
      window.addEventListener('DOMContentLoaded', loadParentDashboard);

      // Handle logout
      document.getElementById('logoutBtn')?.addEventListener('click', () => {
        localStorage.clear();
        window.location.href = 'index.html';
      });
    </script>
  </body>
</html>
